<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar and Wind Data Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
    </style>
</head>
<body>
    <h2>Table-1: Verify Sim</h2>
    <p>This section displays simulated sensor data for verification purposes, showing 30 rows of generated readings.</p>
    <table>
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Temperature (°C)</th>
                <th>Humidity (%)</th>
                <th>Irradiance (W/m²)</th>
                <th>Wind Speed (m/s)</th>
            </tr>
        </thead>
        <tbody>
            <tr><td>2026-01-20 08:00:00</td><td>22.45</td><td>55.23</td><td>245.67</td><td>3.21</td></tr>
            <tr><td>2026-01-20 08:05:00</td><td>23.12</td><td>54.89</td><td>312.45</td><td>2.98</td></tr>
            <tr><td>2026-01-20 08:10:00</td><td>24.78</td><td>53.67</td><td>387.92</td><td>4.15</td></tr>
            <tr><td>2026-01-20 08:15:00</td><td>25.34</td><td>52.44</td><td>456.78</td><td>3.87</td></tr>
            <tr><td>2026-01-20 08:20:00</td><td>26.91</td><td>51.23</td><td>523.41</td><td>4.32</td></tr>
            <tr><td>2026-01-20 08:25:00</td><td>27.56</td><td>50.12</td><td>598.76</td><td>5.01</td></tr>
            <tr><td>2026-01-20 08:30:00</td><td>28.23</td><td>49.87</td><td>667.89</td><td>4.78</td></tr>
            <tr><td>2026-01-20 08:35:00</td><td>28.94</td><td>48.65</td><td>734.52</td><td>5.23</td></tr>
            <tr><td>2026-01-20 08:40:00</td><td>29.67</td><td>47.43</td><td>801.15</td><td>5.67</td></tr>
            <tr><td>2026-01-20 08:45:00</td><td>29.89</td><td>46.78</td><td>845.67</td><td>6.12</td></tr>
            <tr><td>2026-01-20 08:50:00</td><td>29.45</td><td>47.12</td><td>812.34</td><td>5.89</td></tr>
            <tr><td>2026-01-20 08:55:00</td><td>28.76</td><td>48.34</td><td>756.78</td><td>5.45</td></tr>
            <tr><td>2026-01-20 09:00:00</td><td>27.89</td><td>49.56</td><td>689.12</td><td>4.98</td></tr>
            <tr><td>2026-01-20 09:05:00</td><td>26.54</td><td>50.78</td><td>623.45</td><td>4.56</td></tr>
            <tr><td>2026-01-20 09:10:00</td><td>25.23</td><td>51.89</td><td>567.89</td><td>4.12</td></tr>
            <tr><td>2026-01-20 09:15:00</td><td>24.67</td><td>52.34</td><td>523.41</td><td>3.78</td></tr>
            <tr><td>2026-01-20 09:20:00</td><td>24.12</td><td>53.12</td><td>489.76</td><td>3.45</td></tr>
            <tr><td>2026-01-20 09:25:00</td><td>23.89</td><td>53.87</td><td>456.23</td><td>3.21</td></tr>
            <tr><td>2026-01-20 09:30:00</td><td>23.45</td><td>54.23</td><td>423.67</td><td>2.98</td></tr>
            <tr><td>2026-01-20 09:35:00</td><td>23.12</td><td>54.67</td><td>398.54</td><td>2.76</td></tr>
            <tr><td>2026-01-20 09:40:00</td><td>22.78</td><td>55.12</td><td>376.89</td><td>2.54</td></tr>
            <tr><td>2026-01-20 09:45:00</td><td>22.34</td><td>55.78</td><td>354.23</td><td>2.32</td></tr>
        </tbody>
    </table>

    <h2>Table-2: Live Weather Data (Step 2.1 - OpenWeather API Integration)</h2>
    <p>This section displays real-time weather data fetched from OpenWeather API, including temperature, humidity, and wind speed. Data is updated when the ingestion button is triggered.</p>
    <table id="weatherTable">
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Temperature (°C)</th>
                <th>Humidity (%)</th>
                <th>Wind Speed (m/s)</th>
                <th>Source</th>
            </tr>
        </thead>
        <tbody id="weatherTableBody">
            <tr>
                <td colspan="5" style="text-align: center; color: #666;">Click "Trigger Data Ingestion" to fetch live weather data</td>
            </tr>
        </tbody>
    </table>

    <h2>Table-3: NASA POWER Solar Irradiance Data (Step 2.2 - NASA POWER API Integration)</h2>
    <p>This section displays real-time solar irradiance data fetched from NASA POWER API, including 10 data points from the past 2 days. Data is updated when the ingestion button is triggered.</p>
    <table id="nasaPowerTable">
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Solar Irradiance (W/m²)</th>
                <th>Source</th>
            </tr>
        </thead>
        <tbody id="nasaPowerTableBody">
            <tr>
                <td colspan="3" style="text-align: center; color: #666;">Click "Trigger Data Ingestion" to fetch live NASA POWER solar irradiance data</td>
            </tr>
        </tbody>
    </table>

    <!-- Manual Ingestion Trigger Section -->
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <h3>Manual Data Ingestion</h3>
                <p>Click the button below to trigger on-demand data ingestion from sensors and weather APIs.</p>
                <button id="triggerIngestionBtn" class="btn btn-primary btn-lg" onclick="triggerIngestion()">
                    <i class="fas fa-play"></i> Trigger Data Ingestion
                </button>
                <div id="ingestionStatus" class="mt-3" style="display: none;">
                    <div id="statusMessage" class="alert"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript for ingestion trigger -->
    <script>
        async function triggerIngestion() {
            const btn = document.getElementById('triggerIngestionBtn');
            const statusDiv = document.getElementById('ingestionStatus');
            const statusMessage = document.getElementById('statusMessage');

            // Disable button and show loading
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

            statusDiv.style.display = 'block';
            statusMessage.className = 'alert alert-info';
            statusMessage.innerHTML = 'Triggering data ingestion...';

            try {
                const response = await fetch('/trigger_ingestion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const result = await response.json();

                if (result.success) {
                    statusMessage.className = 'alert alert-success';
                    statusMessage.innerHTML = `
                        <strong>Success!</strong> Data ingestion completed.<br>
                        - Sensor data generated: ${result.sensor_generated ? 'Yes' : 'No'}<br>
                        - Weather data fetched: ${result.weather_fetched ? 'Yes' : 'No'}<br>
                        - New rows added: ${result.ingestion_result.new_rows || 0}
                    `;
                } else {
                    statusMessage.className = 'alert alert-danger';
                    statusMessage.innerHTML = `<strong>Error:</strong> ${result.error || 'Unknown error occurred'}`;
                }

            } catch (error) {
                statusMessage.className = 'alert alert-danger';
                statusMessage.innerHTML = `<strong>Network Error:</strong> ${error.message}`;
            } finally {
                // Re-enable button
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-play"></i> Trigger Data Ingestion';
            }
        }
    </script>
</body>
</html>
