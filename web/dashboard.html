<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar and Wind Data Display</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
        }
        h1, h2 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .btn {
            padding: 8px 16px;
            margin: 4px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-success { background-color: #28a745; color: white; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-info { background-color: #17a2b8; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        .alert {
            padding: 12px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .alert-success { background-color: #d4edda; color: #155724; }
        .alert-info { background-color: #d1ecf1; color: #0c5460; }
        .alert-warning { background-color: #fff3cd; color: #856404; }
        .alert-danger { background-color: #f8d7da; color: #721c24; }
        .mt-2 { margin-top: 8px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-3 { margin-bottom: 12px; }
    </style>
</head>
<body>
    <h2>Table-1: Sim Data</h2>
    <p>This section displays simulated sensor data loaded from collect1.txt.</p>
    <div id="simTimestamp" class="mt-2 mb-2" style="font-size: 0.9em; color: #666;"></div>
    <div class="mb-3">
        <button id="fetchDatabaseBtn" class="btn btn-success" onclick="fetchDatabase()">
            Fetch Database
        </button>
        <button id="loadLatestBtn" class="btn btn-primary" onclick="loadLatestData()">
            Latest 10 Rows
        </button>
        <button id="loadTopWindBtn" class="btn btn-info" onclick="loadTopWindSpeed()">
            Top 10 Wind Speed
        </button>
        <button id="loadTopIrradianceBtn" class="btn btn-warning" onclick="loadTopIrradiance()">
            Top 10 Solar Irradiance
        </button>
    </div>
    <table id="simTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Timestamp</th>
                <th>Temperature (°C)</th>
                <th>Humidity (%)</th>
                <th>Irradiance (W/m²)</th>
                <th>Wind Speed (m/s)</th>
                <th>Wind Power Density</th>
                <th>Solar Energy Yield</th>
                <th>Source</th>
            </tr>
        </thead>
        <tbody id="simTableBody">
            <tr>
                <td colspan="9" style="text-align: center; color: #666;">Click "Fetch Database" to load data</td>
            </tr>
        </tbody>
    </table>

    <h2>Table-2: OpenWeather API</h2>
    <p>This section displays weather data from OpenWeather API.</p>
    <div id="weatherTimestamp" class="mt-2 mb-2" style="font-size: 0.9em; color: #666;"></div>
    <div class="mb-3">
        <button id="fetchWeatherDatabaseBtn" class="btn btn-success" onclick="fetchWeatherDatabase()">
            Fetch Database
        </button>
        <button id="loadWeatherLatestBtn" class="btn btn-primary" onclick="loadWeatherLatestData()">
            Latest 10 Rows
        </button>
        <button id="loadWeatherTopWindBtn" class="btn btn-info" onclick="loadWeatherTopWindSpeed()">
            Top 10 Wind Speed
        </button>
        <button id="loadWeatherTopIrradianceBtn" class="btn btn-warning" onclick="loadWeatherTopIrradiance()">
            Top 10 Solar Irradiance
        </button>
    </div>
    <div id="weatherDbStatus" class="mt-3" style="display: none;">
        <div id="weatherDbMessage" class="alert"></div>
    </div>
    <table id="weatherTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Timestamp</th>
                <th>Temperature (°C)</th>
                <th>Humidity (%)</th>
                <th>Irradiance (W/m²)</th>
                <th>Wind Speed (m/s)</th>
                <th>Wind Power Density</th>
                <th>Solar Energy Yield</th>
                <th>Source</th>
            </tr>
        </thead>
        <tbody id="weatherTableBody">
            <tr>
                <td colspan="9" style="text-align: center; color: #666;">Click "Fetch Database" to load weather data</td>
            </tr>
        </tbody>
    </table>

    <h2>Table-3: NASA POWER API</h2>
    <p>This section displays solar irradiance data from NASA POWER API.</p>
    <div id="nasaTimestamp" class="mt-2 mb-2" style="font-size: 0.9em; color: #666;"></div>
    <div class="mb-3">
        <button id="fetchNasaDatabaseBtn" class="btn btn-success" onclick="fetchNasaDatabase()">
            Fetch Database
        </button>
        <button id="loadNasaLatestBtn" class="btn btn-primary" onclick="loadNasaLatestData()">
            Latest 10 Rows
        </button>
        <button id="loadNasaTopWindBtn" class="btn btn-info" onclick="loadNasaTopWindSpeed()">
            Top 10 Wind Speed
        </button>
        <button id="loadNasaTopIrradianceBtn" class="btn btn-warning" onclick="loadNasaTopIrradiance()">
            Top 10 Solar Irradiance
        </button>
    </div>
    <div id="nasaDbStatus" class="mt-3" style="display: none;">
        <div id="nasaDbMessage" class="alert"></div>
    </div>
    <table id="nasaTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Timestamp</th>
                <th>Temperature (°C)</th>
                <th>Humidity (%)</th>
                <th>Irradiance (W/m²)</th>
                <th>Wind Speed (m/s)</th>
                <th>Wind Power Density</th>
                <th>Solar Energy Yield</th>
                <th>Source</th>
            </tr>
        </thead>
        <tbody id="nasaTableBody">
            <tr>
                <td colspan="9" style="text-align: center; color: #666;">Click "Fetch Database" to load NASA POWER data</td>
            </tr>
        </tbody>
    </table>

    <script>
        let simData = [];
        let weatherData = [];
        let nasaData = [];
        let lastUpdateTimestamp = '';
        let simRowCount = 0;
        let nasaRowCount = 0;

        // Parse collect1.txt and extract summary info
        async function loadSimDataFromFile() {
            try {
                const response = await fetch('/data/collect1.txt');
                if (!response.ok) {
                    throw new Error('HTTP error! status: ' + response.status);
                }
                const text = await response.text();
                const lines = text.split('\n');
                
                simData = [];
                let currentSection = '';
                lastUpdateTimestamp = '';
                simRowCount = 0;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    if (line.startsWith('# Data collection last updated:')) {
                        lastUpdateTimestamp = line.replace('# Data collection last updated: ', '');
                    }
                    
                    if (line.startsWith('# Summary:')) {
                        const match = line.match(/sim=(\d+)/);
                        if (match) {
                            simRowCount = parseInt(match[1]);
                        }
                    }
                    
                    if (line.startsWith('[') && line.endsWith(']')) {
                        currentSection = line.slice(1, -1).toLowerCase();
                    }
                    
                    if (line && !line.startsWith('#') && !line.startsWith('[') && !line.startsWith('id,')) {
                        const parts = line.split(',');
                        if (parts.length >= 9 && currentSection === 'sim') {
                            simData.push({
                                id: parts[0] || '',
                                timestamp: parts[1] || '',
                                temperature: parseFloat(parts[2]) || 0,
                                humidity: parseFloat(parts[3]) || 0,
                                irradiance: parseFloat(parts[4]) || 0,
                                wind_speed: parseFloat(parts[5]) || 0,
                                source: parts[6] || 'sim',
                                wind_power_density: parts[7] || '',
                                solar_energy_yield: parts[8] || ''
                            });
                        }
                    }

                }
                
                return true;
            } catch (error) {
                console.error('Error loading sim data:', error);
                return false;
            }
        }

        // Parse collect2.txt for weather data
        async function loadWeatherDataFromFile() {
            try {
                const response = await fetch('/data/collect2.txt');
                if (!response.ok) {
                    throw new Error('HTTP error! status: ' + response.status);
                }
                const text = await response.text();
                const lines = text.split('\n');
                
                weatherData = [];
                let currentSection = '';
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    if (line.startsWith('[') && line.endsWith(']')) {
                        currentSection = line.slice(1, -1).toLowerCase();
                    }
                    
                    if (line && !line.startsWith('#') && !line.startsWith('[') && !line.startsWith('id,')) {
                        const parts = line.split(',');
                        if (parts.length >= 9 && currentSection === 'weather') {
                            weatherData.push({
                                id: parts[0] || '',
                                timestamp: parts[1] || '',
                                temperature: parseFloat(parts[2]) || 0,
                                humidity: parseFloat(parts[3]) || 0,
                                irradiance: parseFloat(parts[4]) || 0,
                                wind_speed: parseFloat(parts[5]) || 0,
                                source: parts[6] || 'openweather',
                                wind_power_density: parts[7] || '',
                                solar_energy_yield: parts[8] || ''
                            });
                        }
                    }

                }
                
                return true;
            } catch (error) {
                console.error('Error loading weather data:', error);
                return false;
            }
        }

        // Parse collect3.txt for NASA POWER data
        async function loadNasaDataFromFile() {
            try {
                const response = await fetch('/data/collect3.txt');
                if (!response.ok) {
                    throw new Error('HTTP error! status: ' + response.status);
                }
                const text = await response.text();
                const lines = text.split('\n');
                
                nasaData = [];
                let currentSection = '';
                nasaRowCount = 0;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    if (line.startsWith('# Summary:')) {
                        const match = line.match(/nasa_power=(\d+)/);
                        if (match) {
                            nasaRowCount = parseInt(match[1]);
                        }
                    }
                    
                    if (line.startsWith('[') && line.endsWith(']')) {
                        currentSection = line.slice(1, -1).toLowerCase();
                    }
                    
                    if (line && !line.startsWith('#') && !line.startsWith('[') && !line.startsWith('id,')) {
                        const parts = line.split(',');
                        if (parts.length >= 9 && currentSection === 'nasa_power') {
                            nasaData.push({
                                id: parts[0] || '',
                                timestamp: parts[1] || '',
                                temperature: parseFloat(parts[2]) || 0,
                                humidity: parseFloat(parts[3]) || 0,
                                irradiance: parseFloat(parts[4]) || 0,
                                wind_speed: parseFloat(parts[5]) || 0,
                                source: parts[6] || 'nasa_power',
                                wind_power_density: parts[7] || '',
                                solar_energy_yield: parts[8] || ''
                            });
                        }
                    }

                }
                
                return true;
            } catch (error) {
                console.error('Error loading NASA data:', error);
                return false;
            }
        }

        // Fetch data from database and update collect1.txt
        async function fetchDatabase() {
            const btn = document.getElementById('fetchDatabaseBtn');
            const timestampDiv = document.getElementById('simTimestamp');

            btn.disabled = true;
            btn.innerHTML = 'Fetching...';
            timestampDiv.innerHTML = 'Fetching data from database...';

            try {
                const response = await fetch('/fetch_sim_data_from_db');
                const result = await response.json();

                if (result.success) {
                    await loadSimDataFromFile();
                    timestampDiv.innerHTML = 'Last updated: ' + lastUpdateTimestamp + ' | Rows: ' + simRowCount;
                    await loadLatestData();
                } else {
                    timestampDiv.innerHTML = 'Error: ' + (result.error || 'Failed to fetch data');
                }
            } catch (error) {
                timestampDiv.innerHTML = 'Error: ' + error.message;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Fetch Database';
            }
        }

        // Fetch weather data from database
        async function fetchWeatherDatabase() {
            const btn = document.getElementById('fetchWeatherDatabaseBtn');
            const statusDiv = document.getElementById('weatherDbStatus');
            const statusMessage = document.getElementById('weatherDbMessage');
            const timestampDiv = document.getElementById('weatherTimestamp');

            btn.disabled = true;
            btn.innerHTML = 'Fetching...';
            statusDiv.style.display = 'block';
            statusMessage.className = 'alert alert-info';
            statusMessage.innerHTML = 'Fetching weather data from database...';

            try {
                const response = await fetch('/fetch_weather_data_from_db');
                const result = await response.json();

                if (result.success) {
                    await loadWeatherDataFromFile();
                    statusMessage.className = 'alert alert-success';
                    statusMessage.innerHTML = 'Weather Data Fetched: ' + result.rows_fetched + ' rows';
                    timestampDiv.innerHTML = 'Last updated: ' + (result.summary ? result.summary.time_range : 'Just now');
                    await loadWeatherLatestData();
                } else {
                    statusMessage.className = 'alert alert-warning';
                    statusMessage.innerHTML = 'Error: ' + (result.error || 'Failed to fetch');
                }
            } catch (error) {
                statusMessage.className = 'alert alert-danger';
                statusMessage.innerHTML = 'Error: ' + error.message;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Fetch Database';
            }
        }

        // Fetch NASA POWER data from database
        async function fetchNasaDatabase() {
            const btn = document.getElementById('fetchNasaDatabaseBtn');
            const statusDiv = document.getElementById('nasaDbStatus');
            const statusMessage = document.getElementById('nasaDbMessage');
            const timestampDiv = document.getElementById('nasaTimestamp');

            btn.disabled = true;
            btn.innerHTML = 'Fetching...';
            statusDiv.style.display = 'block';
            statusMessage.className = 'alert alert-info';
            statusMessage.innerHTML = 'Fetching NASA POWER data from database...';

            try {
                const response = await fetch('/fetch_nasa_data_from_db');
                const result = await response.json();

                if (result.success) {
                    await loadNasaDataFromFile();
                    statusMessage.className = 'alert alert-success';
                    statusMessage.innerHTML = 'NASA Data Fetched: ' + result.rows_fetched + ' rows';
                    timestampDiv.innerHTML = 'Last updated: ' + (result.summary ? result.summary.time_range : 'Just now') + ' | Rows: ' + nasaRowCount;
                    await loadNasaLatestData();
                } else {
                    statusMessage.className = 'alert alert-warning';
                    statusMessage.innerHTML = 'Error: ' + (result.error || 'Failed to fetch');
                }
            } catch (error) {
                statusMessage.className = 'alert alert-danger';
                statusMessage.innerHTML = 'Error: ' + error.message;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Fetch Database';
            }
        }

        // Load and display latest 10 sim rows
        async function loadLatestData() {
            const btn = document.getElementById('loadLatestBtn');
            const tableBody = document.getElementById('simTableBody');
            const timestampDiv = document.getElementById('simTimestamp');

            btn.disabled = true;
            btn.innerHTML = 'Loading...';

            try {
                const success = await loadSimDataFromFile();
                if (success && simData.length > 0) {
                    if (lastUpdateTimestamp) {
                        timestampDiv.innerHTML = 'Last updated: ' + lastUpdateTimestamp + ' | Rows: ' + simRowCount;
                    }

                    const sortedData = simData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    const last10Rows = sortedData.slice(0, 10);

                    tableBody.innerHTML = last10Rows.map((row, index) => 
                        '<tr>' +
                        '<td>' + (row.id || index + 1) + '</td>' +
                        '<td>' + (row.timestamp || 'N/A') + '</td>' +
                        '<td>' + (row.temperature ? row.temperature.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.humidity ? row.humidity.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.irradiance ? row.irradiance.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_speed ? row.wind_speed.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_power_density || '') + '</td>' +
                        '<td>' + (row.solar_energy_yield || '') + '</td>' +
                        '<td>' + (row.source || 'sim') + '</td>' +
                        '</tr>'
                    ).join('');
                } else {
                    tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">No sim data found</td></tr>';
                }
            } catch (error) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">Error loading data</td></tr>';
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Latest 10 Rows';
            }
        }

        // Load and display top 10 wind speed sim rows
        async function loadTopWindSpeed() {
            const btn = document.getElementById('loadTopWindBtn');
            const tableBody = document.getElementById('simTableBody');
            const timestampDiv = document.getElementById('simTimestamp');

            btn.disabled = true;
            btn.innerHTML = 'Loading...';

            try {
                const success = await loadSimDataFromFile();
                if (success && simData.length > 0) {
                    if (lastUpdateTimestamp) {
                        timestampDiv.innerHTML = 'Last updated: ' + lastUpdateTimestamp + ' | Rows: ' + simRowCount;
                    }

                    const sortedData = simData.sort((a, b) => b.wind_speed - a.wind_speed);
                    const top10Rows = sortedData.slice(0, 10);

                    tableBody.innerHTML = top10Rows.map((row, index) => 
                        '<tr>' +
                        '<td>' + (row.id || index + 1) + '</td>' +
                        '<td>' + (row.timestamp || 'N/A') + '</td>' +
                        '<td>' + (row.temperature ? row.temperature.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.humidity ? row.humidity.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.irradiance ? row.irradiance.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_speed ? row.wind_speed.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_power_density || '') + '</td>' +
                        '<td>' + (row.solar_energy_yield || '') + '</td>' +
                        '<td>' + (row.source || 'sim') + '</td>' +
                        '</tr>'
                    ).join('');
                } else {
                    tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">No sim data found</td></tr>';
                }
            } catch (error) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">Error loading data</td></tr>';
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Top 10 Wind Speed';
            }
        }

        // Load and display top 10 irradiance sim rows
        async function loadTopIrradiance() {
            const btn = document.getElementById('loadTopIrradianceBtn');
            const tableBody = document.getElementById('simTableBody');
            const timestampDiv = document.getElementById('simTimestamp');

            btn.disabled = true;
            btn.innerHTML = 'Loading...';

            try {
                const success = await loadSimDataFromFile();
                if (success && simData.length > 0) {
                    if (lastUpdateTimestamp) {
                        timestampDiv.innerHTML = 'Last updated: ' + lastUpdateTimestamp + ' | Rows: ' + simRowCount;
                    }

                    const sortedData = simData.sort((a, b) => b.irradiance - a.irradiance);
                    const top10Rows = sortedData.slice(0, 10);

                    tableBody.innerHTML = top10Rows.map((row, index) => 
                        '<tr>' +
                        '<td>' + (row.id || index + 1) + '</td>' +
                        '<td>' + (row.timestamp || 'N/A') + '</td>' +
                        '<td>' + (row.temperature ? row.temperature.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.humidity ? row.humidity.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.irradiance ? row.irradiance.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_speed ? row.wind_speed.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_power_density || '') + '</td>' +
                        '<td>' + (row.solar_energy_yield || '') + '</td>' +
                        '<td>' + (row.source || 'sim') + '</td>' +
                        '</tr>'
                    ).join('');
                } else {
                    tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">No sim data found</td></tr>';
                }
            } catch (error) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">Error loading data</td></tr>';
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Top 10 Solar Irradiance';
            }
        }

        // Load and display latest 10 weather rows
        async function loadWeatherLatestData() {
            const btn = document.getElementById('loadWeatherLatestBtn');
            const tableBody = document.getElementById('weatherTableBody');
            const timestampDiv = document.getElementById('weatherTimestamp');

            btn.disabled = true;
            btn.innerHTML = 'Loading...';

            try {
                const success = await loadWeatherDataFromFile();
                if (success && weatherData.length > 0) {
                    const sortedData = weatherData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    const last10Rows = sortedData.slice(0, 10);

                    tableBody.innerHTML = last10Rows.map((row, index) => 
                        '<tr>' +
                        '<td>' + (row.id || index + 1) + '</td>' +
                        '<td>' + (row.timestamp || 'N/A') + '</td>' +
                        '<td>' + (row.temperature ? row.temperature.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.humidity ? row.humidity.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.irradiance ? row.irradiance.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_speed ? row.wind_speed.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_power_density || '') + '</td>' +
                        '<td>' + (row.solar_energy_yield || '') + '</td>' +
                        '<td>' + (row.source || 'openweather') + '</td>' +
                        '</tr>'
                    ).join('');
                } else {
                    tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">No weather data found</td></tr>';
                }
            } catch (error) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">Error loading weather data</td></tr>';
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Latest 10 Rows';
            }
        }

        // Load and display top 10 wind speed weather rows
        async function loadWeatherTopWindSpeed() {
            const btn = document.getElementById('loadWeatherTopWindBtn');
            const tableBody = document.getElementById('weatherTableBody');

            btn.disabled = true;
            btn.innerHTML = 'Loading...';

            try {
                const success = await loadWeatherDataFromFile();
                if (success && weatherData.length > 0) {
                    const sortedData = weatherData.sort((a, b) => b.wind_speed - a.wind_speed);
                    const top10Rows = sortedData.slice(0, 10);

                    tableBody.innerHTML = top10Rows.map((row, index) => 
                        '<tr>' +
                        '<td>' + (row.id || index + 1) + '</td>' +
                        '<td>' + (row.timestamp || 'N/A') + '</td>' +
                        '<td>' + (row.temperature ? row.temperature.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.humidity ? row.humidity.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.irradiance ? row.irradiance.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_speed ? row.wind_speed.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_power_density || '') + '</td>' +
                        '<td>' + (row.solar_energy_yield || '') + '</td>' +
                        '<td>' + (row.source || 'openweather') + '</td>' +
                        '</tr>'
                    ).join('');
                } else {
                    tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">No weather data found</td></tr>';
                }
            } catch (error) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">Error loading weather data</td></tr>';
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Top 10 Wind Speed';
            }
        }

        // Load and display top 10 irradiance weather rows
        async function loadWeatherTopIrradiance() {
            const btn = document.getElementById('loadWeatherTopIrradianceBtn');
            const tableBody = document.getElementById('weatherTableBody');

            btn.disabled = true;
            btn.innerHTML = 'Loading...';

            try {
                const success = await loadWeatherDataFromFile();
                if (success && weatherData.length > 0) {
                    const sortedData = weatherData.sort((a, b) => b.irradiance - a.irradiance);
                    const top10Rows = sortedData.slice(0, 10);

                    tableBody.innerHTML = top10Rows.map((row, index) => 
                        '<tr>' +
                        '<td>' + (row.id || index + 1) + '</td>' +
                        '<td>' + (row.timestamp || 'N/A') + '</td>' +
                        '<td>' + (row.temperature ? row.temperature.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.humidity ? row.humidity.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.irradiance ? row.irradiance.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_speed ? row.wind_speed.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_power_density || '') + '</td>' +
                        '<td>' + (row.solar_energy_yield || '') + '</td>' +
                        '<td>' + (row.source || 'openweather') + '</td>' +
                        '</tr>'
                    ).join('');
                } else {
                    tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">No weather data found</td></tr>';
                }
            } catch (error) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">Error loading weather data</td></tr>';
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Top 10 Solar Irradiance';
            }
        }

        // Load and display latest 10 NASA POWER rows
        async function loadNasaLatestData() {
            const btn = document.getElementById('loadNasaLatestBtn');
            const tableBody = document.getElementById('nasaTableBody');
            const timestampDiv = document.getElementById('nasaTimestamp');

            btn.disabled = true;
            btn.innerHTML = 'Loading...';

            try {
                const success = await loadNasaDataFromFile();
                if (success && nasaData.length > 0) {
                    timestampDiv.innerHTML = 'Rows: ' + nasaRowCount;

                    const sortedData = nasaData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    const last10Rows = sortedData.slice(0, 10);

                    tableBody.innerHTML = last10Rows.map((row, index) => 
                        '<tr>' +
                        '<td>' + (row.id || index + 1) + '</td>' +
                        '<td>' + (row.timestamp || 'N/A') + '</td>' +
                        '<td>' + (row.temperature ? row.temperature.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.humidity ? row.humidity.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.irradiance ? row.irradiance.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_speed ? row.wind_speed.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_power_density || '') + '</td>' +
                        '<td>' + (row.solar_energy_yield || '') + '</td>' +
                        '<td>' + (row.source || 'nasa_power') + '</td>' +
                        '</tr>'
                    ).join('');
                } else {
                    tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">No NASA POWER data found</td></tr>';
                }
            } catch (error) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">Error loading NASA data</td></tr>';
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Latest 10 Rows';
            }
        }

        // Load and display top 10 wind speed NASA rows
        async function loadNasaTopWindSpeed() {
            const btn = document.getElementById('loadNasaTopWindBtn');
            const tableBody = document.getElementById('nasaTableBody');
            const timestampDiv = document.getElementById('nasaTimestamp');

            btn.disabled = true;
            btn.innerHTML = 'Loading...';

            try {
                const success = await loadNasaDataFromFile();
                if (success && nasaData.length > 0) {
                    timestampDiv.innerHTML = 'Rows: ' + nasaRowCount;

                    const sortedData = nasaData.sort((a, b) => b.wind_speed - a.wind_speed);
                    const top10Rows = sortedData.slice(0, 10);

                    tableBody.innerHTML = top10Rows.map((row, index) => 
                        '<tr>' +
                        '<td>' + (row.id || index + 1) + '</td>' +
                        '<td>' + (row.timestamp || 'N/A') + '</td>' +
                        '<td>' + (row.temperature ? row.temperature.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.humidity ? row.humidity.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.irradiance ? row.irradiance.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_speed ? row.wind_speed.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_power_density || '') + '</td>' +
                        '<td>' + (row.solar_energy_yield || '') + '</td>' +
                        '<td>' + (row.source || 'nasa_power') + '</td>' +
                        '</tr>'
                    ).join('');
                } else {
                    tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">No NASA POWER data found</td></tr>';
                }
            } catch (error) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">Error loading NASA data</td></tr>';
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Top 10 Wind Speed';
            }
        }

        // Load and display top 10 irradiance NASA rows
        async function loadNasaTopIrradiance() {
            const btn = document.getElementById('loadNasaTopIrradianceBtn');
            const tableBody = document.getElementById('nasaTableBody');
            const timestampDiv = document.getElementById('nasaTimestamp');

            btn.disabled = true;
            btn.innerHTML = 'Loading...';

            try {
                const success = await loadNasaDataFromFile();
                if (success && nasaData.length > 0) {
                    timestampDiv.innerHTML = 'Rows: ' + nasaRowCount;

                    const sortedData = nasaData.sort((a, b) => b.irradiance - a.irradiance);
                    const top10Rows = sortedData.slice(0, 10);

                    tableBody.innerHTML = top10Rows.map((row, index) => 
                        '<tr>' +
                        '<td>' + (row.id || index + 1) + '</td>' +
                        '<td>' + (row.timestamp || 'N/A') + '</td>' +
                        '<td>' + (row.temperature ? row.temperature.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.humidity ? row.humidity.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.irradiance ? row.irradiance.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_speed ? row.wind_speed.toFixed(2) : 'N/A') + '</td>' +
                        '<td>' + (row.wind_power_density || '') + '</td>' +
                        '<td>' + (row.solar_energy_yield || '') + '</td>' +
                        '<td>' + (row.source || 'nasa_power') + '</td>' +
                        '</tr>'
                    ).join('');
                } else {
                    tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">No NASA POWER data found</td></tr>';
                }
            } catch (error) {
                tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; color: #666;">Error loading NASA data</td></tr>';
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Top 10 Solar Irradiance';
            }
        }
    </script>
</body>
</html>
